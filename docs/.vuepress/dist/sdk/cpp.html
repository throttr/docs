<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.23" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const useChoice = localStorage.getItem('vuepress-color-scheme')
      const systemStatus =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (useChoice === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (useChoice === 'dark' || systemStatus) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>C++ | Throttr — Sovereign Real-Time Data & Messaging Engine</title><meta name="description" content="The limit is set by your machine and your architecture.">
    <link rel="preload" href="/assets/style-QdoVQjjr.css" as="style"><link rel="stylesheet" href="/assets/style-QdoVQjjr.css">
    <link rel="modulepreload" href="/assets/app-BgH2enP9.js"><link rel="modulepreload" href="/assets/cpp.html-Yy56PJLN.js">
    <link rel="prefetch" href="/assets/about-protocol.html-DNygBAd1.js" as="script"><link rel="prefetch" href="/assets/about-server.html-D5XvI154.js" as="script"><link rel="prefetch" href="/assets/get-started.html-BJLQ9mVW.js" as="script"><link rel="prefetch" href="/assets/index.html-D500VYM2.js" as="script"><link rel="prefetch" href="/assets/java.html-CJTJBUg0.js" as="script"><link rel="prefetch" href="/assets/php.html-B9I9yMCm.js" as="script"><link rel="prefetch" href="/assets/typescript.html-CktiiToS.js" as="script"><link rel="prefetch" href="/assets/404.html-BEqMq4p9.js" as="script"><link rel="prefetch" href="/assets/mermaid.esm.min-Dk2JvINc.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/"><img class="vp-site-logo" src="/images/logo.png" alt="Throttr — Sovereign Real-Time Data &amp; Messaging Engine"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">Throttr — Sovereign Real-Time Data &amp; Messaging Engine</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/" aria-label="Home"><!--[--><!--[--><!--]--><!--]-->Home<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/get-started.html" aria-label="Get Started"><!--[--><!--[--><!--]--><!--]-->Get Started<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/about-protocol.html" aria-label="About Protocol"><!--[--><!--[--><!--]--><!--]-->About Protocol<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/about-server.html" aria-label="About Server"><!--[--><!--[--><!--]--><!--]-->About Server<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/" aria-label="Home"><!--[--><!--[--><!--]--><!--]-->Home<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/get-started.html" aria-label="Get Started"><!--[--><!--[--><!--]--><!--]-->Get Started<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/about-protocol.html" aria-label="About Protocol"><!--[--><!--[--><!--]--><!--]-->About Protocol<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/about-server.html" aria-label="About Server"><!--[--><!--[--><!--]--><!--]-->About Server<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">C++ <!----></p><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div id="content"><h1 id="c" tabindex="-1"><a class="header-anchor" href="#c"><span>C++</span></a></h1><h2 id="installation" tabindex="-1"><a class="header-anchor" href="#installation"><span>Installation</span></a></h2><p>Add the dependency to your <code>CMakeLists.txt</code>:</p><div class="language-CMakeLists.txt line-numbers-mode" data-highlighter="prismjs" data-ext="CMakeLists.txt"><pre><code class="language-CMakeLists.txt"><span class="line">include(FetchContent)</span>
<span class="line">        FetchContent_Declare(</span>
<span class="line">        throttr-sdk</span>
<span class="line">        GIT_REPOSITORY https://github.com/throttr/cpp.git</span>
<span class="line">        GIT_TAG 5.1.1</span>
<span class="line">)</span>
<span class="line">FetchContent_MakeAvailable(throttr-sdk)</span>
<span class="line"></span>
<span class="line">target_link_libraries(</span>
<span class="line">    YourProgram</span>
<span class="line">    throttr::sdk</span>
<span class="line">)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="basic-usage" tabindex="-1"><a class="header-anchor" href="#basic-usage"><span>Basic Usage</span></a></h2><h3 id="get-connected" tabindex="-1"><a class="header-anchor" href="#get-connected"><span>Get Connected</span></a></h3><p>Use the Service to create a communication channel between your application and Throttr server.</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;throttr/service.hpp&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">using</span> <span class="token keyword">namespace</span> throttr<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> <span class="token keyword">auto</span> _host <span class="token operator">=</span> <span class="token string">&quot;throttr&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token keyword">auto</span> _port <span class="token operator">=</span> <span class="token number">9000</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token keyword">auto</span> _connections <span class="token operator">=</span> <span class="token number">9000</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">boost<span class="token double-colon punctuation">::</span>asio<span class="token double-colon punctuation">::</span>io_context _io<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">service_config _cfg<span class="token punctuation">{</span></span>
<span class="line">    _host<span class="token punctuation">,</span></span>
<span class="line">    _port<span class="token punctuation">,</span></span>
<span class="line">    _connections</span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> <span class="token keyword">auto</span> _service <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_unique</span><span class="token generic class-name"><span class="token operator">&lt;</span>service<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>_io<span class="token punctuation">.</span><span class="token function">get_executor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> _cfg<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">bool</span> _ready <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">_service<span class="token operator">-&gt;</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> boost<span class="token double-colon punctuation">::</span>system<span class="token double-colon punctuation">::</span>error_code <span class="token operator">&amp;</span>ec<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>ec<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">runtime_exception</span><span class="token punctuation">(</span><span class="token string">&quot;Server is gone&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    _ready <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>_ready<span class="token punctuation">)</span></span>
<span class="line">    _io<span class="token punctuation">.</span><span class="token function">run_one</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">_io<span class="token punctuation">.</span><span class="token function">restart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>After that, <code>service</code> will be an instance that can be used in concurrently.</p><p>My recommendation, use just one <code>_service</code> per thread.</p><h3 id="sending-requests" tabindex="-1"><a class="header-anchor" href="#sending-requests"><span>Sending Requests</span></a></h3><p>The following operations are based in Throttr protocol <code>v5.0.0</code>.</p><h4 id="insert" tabindex="-1"><a class="header-anchor" href="#insert"><span>INSERT</span></a></h4><p>If you want to create a <code>counter</code> to track requests or metrics. Then <code>INSERT</code> is for you.</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;throttr/protocol_wrapper.hpp&gt;</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;throttr/response_status.hpp&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">using</span> <span class="token keyword">namespace</span> throttr<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string _key <span class="token operator">=</span> <span class="token string">&quot;consumer&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token keyword">auto</span> _quota <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token keyword">auto</span> _ttl_type <span class="token operator">=</span> ttl_types<span class="token double-colon punctuation">::</span>seconds<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token keyword">auto</span> _ttl <span class="token operator">=</span> <span class="token number">60</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>byte<span class="token operator">&gt;</span> _insert_buffer <span class="token operator">=</span> <span class="token function">request_insert_builder</span><span class="token punctuation">(</span></span>
<span class="line">    _quota<span class="token punctuation">,</span></span>
<span class="line">    _ttl_type<span class="token punctuation">,</span></span>
<span class="line">    _ttl<span class="token punctuation">,</span></span>
<span class="line">    _key</span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">_service<span class="token operator">-&gt;</span><span class="token generic-function"><span class="token function">send</span><span class="token generic class-name"><span class="token operator">&lt;</span>response_status<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>_insert_buffer<span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> boost<span class="token double-colon punctuation">::</span>system<span class="token double-colon punctuation">::</span>error_code<span class="token operator">&amp;</span> ec<span class="token punctuation">,</span> <span class="token keyword">const</span> response_status result<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ec<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;Success: &quot;</span> <span class="token operator">&lt;&lt;</span> result<span class="token punctuation">.</span>success_ <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">            std<span class="token double-colon punctuation">::</span>cerr <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;Something went wrong: &quot;</span> <span class="token operator">&lt;&lt;</span> ec<span class="token punctuation">.</span><span class="token function">what</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>There are only one condition that <code>success_</code> can be <code>false</code>, and is, when the <code>key</code> already exists.</p><h4 id="query" tabindex="-1"><a class="header-anchor" href="#query"><span>QUERY</span></a></h4><p>If you want to recover the <code>counter</code> value or TTL specification. Then <code>QUERY</code> is for you.</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;throttr/protocol_wrapper.hpp&gt;</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;throttr/response_query.hpp&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">using</span> <span class="token keyword">namespace</span> throttr<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string _key <span class="token operator">=</span> <span class="token string">&quot;consumer&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>byte<span class="token operator">&gt;</span> _query_buffer <span class="token operator">=</span> <span class="token function">request_query_builder</span><span class="token punctuation">(</span>_key<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">_service<span class="token operator">-&gt;</span><span class="token generic-function"><span class="token function">send</span><span class="token generic class-name"><span class="token operator">&lt;</span>response_query<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>_query_buffer<span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> boost<span class="token double-colon punctuation">::</span>system<span class="token double-colon punctuation">::</span>error_code<span class="token operator">&amp;</span> ec<span class="token punctuation">,</span> <span class="token keyword">const</span> response_query result<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ec<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;Success: &quot;</span> <span class="token operator">&lt;&lt;</span> result<span class="token punctuation">.</span>success_ <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></span>
<span class="line">            </span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>success_<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;Quota: &quot;</span> <span class="token operator">&lt;&lt;</span> result<span class="token punctuation">.</span>quota_ <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></span>
<span class="line">                std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;TTL: &quot;</span> <span class="token operator">&lt;&lt;</span> result<span class="token punctuation">.</span>ttl_ <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></span>
<span class="line">                std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;TTL_Type: &quot;</span> <span class="token operator">&lt;&lt;</span> result<span class="token punctuation">.</span>ttl_type_ <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">            std<span class="token double-colon punctuation">::</span>cerr <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;Something went wrong: &quot;</span> <span class="token operator">&lt;&lt;</span> ec<span class="token punctuation">.</span><span class="token function">what</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>There are only one condition that <code>success_</code> can be <code>false</code>, and is, when the <code>key</code> doesn&#39;t exist.</p><p>In that case, <code>quota_</code>, <code>ttl_</code> and <code>ttl_type_</code> will contain <code>invalid</code> values.</p><h4 id="update" tabindex="-1"><a class="header-anchor" href="#update"><span>UPDATE</span></a></h4><p>If you want to modify the <code>counter</code> value or TTL. Then <code>UPDATE</code> is for you.</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;throttr/protocol_wrapper.hpp&gt;</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;throttr/response_status.hpp&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">using</span> <span class="token keyword">namespace</span> throttr<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string _key <span class="token operator">=</span> <span class="token string">&quot;consumer&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token keyword">auto</span> _attribute_type <span class="token operator">=</span> attribute_types<span class="token double-colon punctuation">::</span>quota<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token keyword">auto</span> _change_type <span class="token operator">=</span> change_types<span class="token double-colon punctuation">::</span>decrease<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> value_type _value <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>byte<span class="token operator">&gt;</span> _update_buffer <span class="token operator">=</span> <span class="token function">request_update_builder</span><span class="token punctuation">(</span></span>
<span class="line">    _attribute_type<span class="token punctuation">,</span></span>
<span class="line">    _change_type<span class="token punctuation">,</span></span>
<span class="line">    _value<span class="token punctuation">,</span></span>
<span class="line">    _key</span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">_service<span class="token operator">-&gt;</span><span class="token generic-function"><span class="token function">send</span><span class="token generic class-name"><span class="token operator">&lt;</span>response_status<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>_update_buffer<span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> boost<span class="token double-colon punctuation">::</span>system<span class="token double-colon punctuation">::</span>error_code<span class="token operator">&amp;</span> ec<span class="token punctuation">,</span> <span class="token keyword">const</span> response_status result<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ec<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;Success: &quot;</span> <span class="token operator">&lt;&lt;</span> result<span class="token punctuation">.</span>success_ <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">            std<span class="token double-colon punctuation">::</span>cerr <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;Something went wrong: &quot;</span> <span class="token operator">&lt;&lt;</span> ec<span class="token punctuation">.</span><span class="token function">what</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>There are two attributes that can be modified <code>Quota</code> and <code>TTL</code>.</p><p>There are three change type that can be invoked:</p><ul><li><code>PATCH</code> to replace the value.</li><li><code>INCREASE</code> to extend the quota or increase the metric.</li><li><code>DECREASE</code> to consume the quota or decrease the metric.</li></ul><p>There are two different cases that <code>success_</code> can be <code>false</code>:</p><ul><li><code>Key</code> doesn&#39;t exists.</li><li><code>Quota</code> is less than the value that want to be reduced. IE: Quota is 20, but you want to <code>DECREASE</code> 50.</li></ul><p>The last case is relevant because you can combine <code>INSERT</code> + <code>UPDATE</code> as pattern.</p><h4 id="purge" tabindex="-1"><a class="header-anchor" href="#purge"><span>PURGE</span></a></h4><p>If you want, manually, remove the <code>counter</code> or <code>buffer</code>. Then <code>PURGE</code> is for you.</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;throttr/protocol_wrapper.hpp&gt;</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;throttr/response_status.hpp&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">using</span> <span class="token keyword">namespace</span> throttr<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string _key <span class="token operator">=</span> <span class="token string">&quot;consumer&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>byte<span class="token operator">&gt;</span> _purge_buffer <span class="token operator">=</span> <span class="token function">request_purge_builder</span><span class="token punctuation">(</span></span>
<span class="line">    _key</span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">_service<span class="token operator">-&gt;</span><span class="token generic-function"><span class="token function">send</span><span class="token generic class-name"><span class="token operator">&lt;</span>response_status<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>_purge_buffer<span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> boost<span class="token double-colon punctuation">::</span>system<span class="token double-colon punctuation">::</span>error_code<span class="token operator">&amp;</span> ec<span class="token punctuation">,</span> <span class="token keyword">const</span> response_status result<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ec<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;Success: &quot;</span> <span class="token operator">&lt;&lt;</span> result<span class="token punctuation">.</span>success_ <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">            std<span class="token double-colon punctuation">::</span>cerr <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;Something went wrong: &quot;</span> <span class="token operator">&lt;&lt;</span> ec<span class="token punctuation">.</span><span class="token function">what</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>There are only one condition that <code>success_</code> can be <code>false</code>, and is, when the <code>key</code> doesn&#39;t exist.</p><h4 id="set" tabindex="-1"><a class="header-anchor" href="#set"><span>SET</span></a></h4><p>If you want, create a <code>buffer</code> (arbitrary data in memory). Then <code>SET</code> is for you.</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;throttr/protocol_wrapper.hpp&gt;</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;throttr/response_status.hpp&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">using</span> <span class="token keyword">namespace</span> throttr<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string _key <span class="token operator">=</span> <span class="token string">&quot;consumer&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token keyword">auto</span> _ttl_type <span class="token operator">=</span> ttl_types<span class="token double-colon punctuation">::</span>seconds<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token keyword">auto</span> _ttl <span class="token operator">=</span> <span class="token number">60</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>vector _value <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    std<span class="token double-colon punctuation">::</span>byte<span class="token punctuation">{</span><span class="token char">&#39;E&#39;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    std<span class="token double-colon punctuation">::</span>byte<span class="token punctuation">{</span><span class="token char">&#39;H&#39;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    std<span class="token double-colon punctuation">::</span>byte<span class="token punctuation">{</span><span class="token char">&#39;L&#39;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    std<span class="token double-colon punctuation">::</span>byte<span class="token punctuation">{</span><span class="token char">&#39;O&#39;</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>byte<span class="token operator">&gt;</span> _set_buffer <span class="token operator">=</span> <span class="token function">request_set_builder</span><span class="token punctuation">(</span></span>
<span class="line">    _value<span class="token punctuation">,</span></span>
<span class="line">    _ttl_type<span class="token punctuation">,</span></span>
<span class="line">    _ttl<span class="token punctuation">,</span></span>
<span class="line">    _key</span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">_service<span class="token operator">-&gt;</span><span class="token generic-function"><span class="token function">send</span><span class="token generic class-name"><span class="token operator">&lt;</span>response_status<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>_set_buffer<span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> boost<span class="token double-colon punctuation">::</span>system<span class="token double-colon punctuation">::</span>error_code<span class="token operator">&amp;</span> ec<span class="token punctuation">,</span> <span class="token keyword">const</span> response_status result<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ec<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;Success: &quot;</span> <span class="token operator">&lt;&lt;</span> result<span class="token punctuation">.</span>success_ <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">            std<span class="token double-colon punctuation">::</span>cerr <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;Something went wrong: &quot;</span> <span class="token operator">&lt;&lt;</span> ec<span class="token punctuation">.</span><span class="token function">what</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>There are only one condition that <code>success</code> can be <code>false</code>, and is, when the <code>key</code> already exist.</p><h4 id="get" tabindex="-1"><a class="header-anchor" href="#get"><span>GET</span></a></h4><p>If you want, recover a <code>buffer</code>. Then <code>GET</code> is for you.</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;throttr/protocol_wrapper.hpp&gt;</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;throttr/response_get.hpp&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">using</span> <span class="token keyword">namespace</span> throttr<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string _key <span class="token operator">=</span> <span class="token string">&quot;consumer&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>byte<span class="token operator">&gt;</span> _get_buffer <span class="token operator">=</span> <span class="token function">request_get_builder</span><span class="token punctuation">(</span></span>
<span class="line">    _key</span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">_service<span class="token operator">-&gt;</span><span class="token generic-function"><span class="token function">send</span><span class="token generic class-name"><span class="token operator">&lt;</span>response_get<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>_get_buffer<span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> boost<span class="token double-colon punctuation">::</span>system<span class="token double-colon punctuation">::</span>error_code<span class="token operator">&amp;</span> ec<span class="token punctuation">,</span> <span class="token keyword">const</span> response_get result<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ec<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;Success: &quot;</span> <span class="token operator">&lt;&lt;</span> result<span class="token punctuation">.</span>success_ <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></span>
<span class="line">            </span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>success_<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;Value: &quot;</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span> <span class="token operator">&amp;</span> byte <span class="token operator">:</span> result<span class="token punctuation">.</span>value_<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> byte<span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">                std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></span>
<span class="line">                std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;TTL: &quot;</span> <span class="token operator">&lt;&lt;</span> result<span class="token punctuation">.</span>ttl_ <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></span>
<span class="line">                std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;TTL_Type: &quot;</span> <span class="token operator">&lt;&lt;</span> result<span class="token punctuation">.</span>ttl_type_ <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">            std<span class="token double-colon punctuation">::</span>cerr <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;Something went wrong: &quot;</span> <span class="token operator">&lt;&lt;</span> ec<span class="token punctuation">.</span><span class="token function">what</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>There are only one condition that <code>success</code> can be <code>false</code>, and is, when the <code>key</code> doesn&#39;t exist.</p><h3 id="get-disconnected" tabindex="-1"><a class="header-anchor" href="#get-disconnected"><span>Get Disconnected</span></a></h3><p>Once your operations has been finished, you could release resources using:</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line">_service<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="advanced-usage" tabindex="-1"><a class="header-anchor" href="#advanced-usage"><span>Advanced Usage</span></a></h2><p>I will show you my recommended usages as previous requests are just raw protocol.</p><h3 id="optimized-rate-limiter" tabindex="-1"><a class="header-anchor" href="#optimized-rate-limiter"><span>Optimized Rate Limiter</span></a></h3><p>Avoid the usage of <code>INSERT</code> and <code>UPDATE</code> as two separated requests. Call it as <code>batch</code>.</p><p>The <code>send_many</code> function is variadic. This reduces two or more requests in a single TCP message.</p><p>This mechanism provides to you enough information to <code>allow</code> or <code>block</code> a request.</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;throttr/protocol_wrapper.hpp&gt;</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;throttr/response_status.hpp&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">using</span> <span class="token keyword">namespace</span> throttr<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string _key <span class="token operator">=</span> <span class="token string">&quot;consumer&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token keyword">auto</span> _quota <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token keyword">auto</span> _ttl_type <span class="token operator">=</span> ttl_types<span class="token double-colon punctuation">::</span>seconds<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token keyword">auto</span> _ttl <span class="token operator">=</span> <span class="token number">60</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>byte<span class="token operator">&gt;</span> _insert_buffer <span class="token operator">=</span> <span class="token function">request_insert_builder</span><span class="token punctuation">(</span></span>
<span class="line">    _quota<span class="token punctuation">,</span></span>
<span class="line">    _ttl_type<span class="token punctuation">,</span></span>
<span class="line">    _ttl<span class="token punctuation">,</span></span>
<span class="line">    _key</span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> <span class="token keyword">auto</span> _attribute_type <span class="token operator">=</span> attribute_types<span class="token double-colon punctuation">::</span>quota<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token keyword">auto</span> _change_type <span class="token operator">=</span> change_types<span class="token double-colon punctuation">::</span>decrease<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> value_type _value <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>byte<span class="token operator">&gt;</span> _update_buffer <span class="token operator">=</span> <span class="token function">request_update_builder</span><span class="token punctuation">(</span></span>
<span class="line">    _attribute_type<span class="token punctuation">,</span></span>
<span class="line">    _change_type<span class="token punctuation">,</span></span>
<span class="line">    _value<span class="token punctuation">,</span></span>
<span class="line">    _key</span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">std<span class="token double-colon punctuation">::</span>vector _requests <span class="token operator">=</span> <span class="token punctuation">{</span>_insert_buffer<span class="token punctuation">,</span> _update_buffer<span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">_service<span class="token operator">-&gt;</span><span class="token generic-function"><span class="token function">send_many</span><span class="token generic class-name"><span class="token operator">&lt;</span></span>
<span class="line">    response_status<span class="token punctuation">,</span></span>
<span class="line">    response_status</span>
<span class="line"><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span></span>
<span class="line">        <span class="token keyword">const</span> boost<span class="token double-colon punctuation">::</span>system<span class="token double-colon punctuation">::</span>error_code<span class="token operator">&amp;</span> ec<span class="token punctuation">,</span></span>
<span class="line">        <span class="token keyword">const</span> response_status insert_result<span class="token punctuation">,</span></span>
<span class="line">        <span class="token keyword">const</span> response_status update_result</span>
<span class="line">    <span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ec<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;Insert Success: &quot;</span> <span class="token operator">&lt;&lt;</span> insert_result<span class="token punctuation">.</span>success_ <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></span>
<span class="line">            std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;Update Success: &quot;</span> <span class="token operator">&lt;&lt;</span> update_result<span class="token punctuation">.</span>success_ <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">            std<span class="token double-colon punctuation">::</span>cerr <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;Something went wrong: &quot;</span> <span class="token operator">&lt;&lt;</span> ec<span class="token punctuation">.</span><span class="token function">what</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>_requests<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>If <code>INSERT</code> was <code>success</code> then is the first consume time and if <code>UPDATE</code> was <code>success</code> then the user had available quota.</p><p>See more examples in <a href="https://github.com/throttr/cpp/blob/master/tests/service_test.cc" target="_blank" rel="noopener noreferrer">tests</a>.</p><h2 id="technical-notes" tabindex="-1"><a class="header-anchor" href="#technical-notes"><span>Technical Notes</span></a></h2><ul><li>The protocol assumes Little Endian architecture.</li><li>The internal message queue ensures requests are processed sequentially.</li><li>The package is defined to works with protocol 4.0.17 or greatest.</li></ul><hr><h2 id="license" tabindex="-1"><a class="header-anchor" href="#license"><span>License</span></a></h2><p>Distributed under the <a href="https://github.com/throttr/typescript/blob/master/LICENSE" target="_blank" rel="noopener noreferrer">GNU Affero General Public License v3.0</a>.</p></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Last Updated:: </span><time class="meta-item-info" datetime="2025-05-23T02:46:51.000Z" data-allow-mismatch>5/22/25, 10:46 PM</time></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: iantorres@outlook.com">Ian Torres</span><!----><!--]--><!--]--></span></div></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-BgH2enP9.js" defer></script>
  </body>
</html>
